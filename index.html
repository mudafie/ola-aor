<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Article 990 - Affidavit of Response Generator</title>
        <script src="./pizzip.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.42.3/docxtemplater.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
        <link rel="icon" href="./favicon.png">
        <style>
            body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; background: #f7f7f8; 
                position: relative; overflow-x: hidden;
            }
            /* Background image layer */
            body::before {
                content: "";
                position: fixed;
                inset: 0;
                background-image: url("./ola-seal.png");
                background-repeat: no-repeat;
                background-size: 1500px 1500px;
                background-position: center 30%;
                opacity: 0.10;
                pointer-events: none;
                z-index: -2;
            }
            /* Light overlay to keep text readable */
            body::after{
                content: "";
                position: fixed;
                inset: 0;
                background: rgba(247,247,248.0.92);
                pointer-events: none;
                z-index: -1;
            }
            .wrap { max-width: 980px; margin: 0 auto; }
            .card { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 18px; margin-bottom: 14px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
            h1 { margin: 0 0 6px; font-size: 22px; }
            .muted { color: #4b5563; font-size: 13px; margin: 0; }
            label { display: block; font-size: 13px; color: #374151; margin-bottom: 6px; }
            input[type="text"], input[type="email"], input[type="date"], select, textarea {
                width: 100%; padding: 10px 10px; border: 1px solid #d1d5db; border-radius: 10px; font-size: 14px; background: #fff;
            }
            /* Fix overlapping/overflowing inputs and textareas */
            *, *::before, *::after {
                box-sizing: border-box;
            }
            input, select, textarea {
                max-width: 100%;
            }
            textarea { resize: vertical; min-height: 120px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
            .grid { display: grid; gap: 12px; }
            .grid2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
            .grid3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
            @media (max-width: 860px) { .grid2, .grid3 { grid-template-columns: 1fr; } }
            .row { display: flex; gap: 14px; flex-wrap: wrap; align-items: center; }
            .radio { display: inline-flex; align-items: center; gap: 8px; font-size: 14px; }
            .radio input { transform: translateY(1px); }
            button {
                width: 100%; padding: 14px 14px; border: none; border-radius: 12px;
                background: #2563eb; color: #fff; font-weight: 700; font-size: 16px; cursor: pointer;
            }
            button:hover { background: #1d4ed8; }
            .ok { color: #065f46; font-size: 13px; margin-top: 6px; }
            .warn { color: #92400e; font-size: 13px; margin-top: 6px; }
            .tiny { font-size: 12px; color: #6b7280; }
            .divider { height: 1px; background: #e5e7eb; margin: 14px 0; }
        </style>
    </head>
    <body>
        <div class="wrap">
            <div class="card">
                <h1>Louisiana Article 990 - Affidavit of Response Generator</h1>
                <p class="muted">This runs entirely in your browser. It generates an .docx file.</p>
            </div>

            <div class="card">
                <h2 style="margin:0 0 10px; font-size:16px;">Template</h2>
                <label for="templateFile">Upload Word Template (.docx)</label>
                <input id="templateFile" type="file" accept=".docx" />
                <div class="tiny">Upload your .docx template with {placeholders} one time. It will be remembered.</div>
                <div id="templateStatus" class="tiny" style="margin-top:6px;"></div>
            </div>

            <div class="card">
                <h2 style="margin:0 0 10px; font-size:16px;">File Information</h2>
                <div class="grid grid2">
                    <div>
                        <label for="fileNumber">Office File Number</label>
                        <input id="fileNumber" name="fileNumber" type="text" placeholder="e.g., L-123456" />
                    </div>
                    <div>
                        <label for="logNumber">Bureau Log Number</label>
                        <input id="logNumber" name="logNumber" type="text" placeholder="e.g., EXP-123456" />
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 style="margin:0 0 10px; font-size:16px;">Case Caption</h2>
                <div class="grid grid2">
                    <div>
                        <label for="defendantName">Defendant Name</label>
                        <input id="defendantName" name="defendantName" type="text" placeholder="e.g., Barb Dwyer" />
                    </div>
                    <div>
                        <label for="parish">Parish</label>
                        <select id="parish" name="parish">
                            <option value="">Select Parish</option>
                        </select>
                        <div id="districtHint" class="ok" style="display:none;"></div>
                    </div>

                    <div>
                        <label for="docketNumber">Docket Number</label>
                        <input id="docketNumber" name="docketNumber" type="text" placeholder="e.g., 25-123456" />
                    </div>
                    <div>
                        <label for="division">Division</label>
                        <input id="division" name="division" type="text" placeholder="Leave blank if none" />
                    </div>
                </div>
            </div>

            <div class="card" id="section-bureau">
                <h2 style="margin:0 0 10px; font-size:16px;">Louisiana Bureau Response</h2>
                <div class="row" style="margin-bottom:10px;">
                    <label class="radio"><input type="radio" name="bureauResponse" value="no-opposition" checked> No Opposition</label>
                    <label class="radio"><input type="radio" name="bureauResponse" value="opposition"> Opposition with Reasons</label>
                </div>
                <div class="grid grid2">
                    <div>
                        <label for="bureauNoOppositionText">Bureau No Opposition Text</label>
                        <input id="bureauNoOppositionText" name="bureauNoOppositionText" type="text" value="The Bureau does not oppose this motion for expungement." />
                    </div>
                    <div>
                        <label for="bureauObjectionPreset">Bureau Objections</label>
                        <div class="row">
                            <select id="bureauObjectionPreset" style="flex: 1;">
                                <option value="">Select an objection (optional)</option>
                            </select>
                            <button id="addBureauObjectionBtn" type="button" style="width:auto; padding:10px 14px; border-radius:10px">Add</button>
                            <button id="clearBureauObjectionBtn" type="button" style="width:auto; padding:10px 14px; border-radius:10px; background:#6b7280;">Clear</button>
                        </div>
                        <div class="tiny">Click "Add" to append the selected objection into the box below. Click "Clear" to clear the box.</div>
                    </div>
                    <div>
                        <label for="bureauObjectionText">Bureau Objection Text (only used if opposing)</label>
                        <textarea id="bureauObjectionText" name="bureauObjectionText" placeholder="Enter the complete objection text here..."></textarea>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 style="margin:0 0 10px; font-size:16px;">Please Serve</h2>
                <div class="grid grid2">
                    <div>
                        <label for="arrestingAgency">Arresting Law Enforcement Agency</label>
                        <input id="arrestingAgency" name="arrestingAgency" type="text" placeholder="e.g., Louisiana State Police" />
                    </div>
                    <div>
                        <label for="defenseRecipient">Defense Recipient</label>
                        <select id="defenseRecipient" name="defenseRecipient">
                            <option value="counsel" selected> Defendant, through counsel of record</option>
                            <option value="defendant">Defendant</option>
                        </select>
                        <div class="tiny">Select who is being served on the defense side</div>
                    </div>
                    <div>
                        <label for="defenseAttorney">Defense Name</label>
                        <input id="defenseAttorney" name="defenseAttorney" type="text" placeholder="e.g., Barb Dwyer" />
                    </div>
                    <div>
                        <label for="defenseAddress">Defense Address</label>
                        <input id="defenseAddress" name="defenseAddress" type="text" placeholder="e.g., 123 Main Street, Anytown, LA 70000" />
                    </div>
                    <div>
                        <label for="serviceDatePicker">Service Date</label>
                        <input id="serviceDatePicker" type="date" />
                        <div class="tiny" style="margin-top:4px;">Day number: <span id="serviceDateDisplay">--</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <button id="generateBtn" type="button">Generate DOCX Document</button>
                <div id="status" class="tiny" style="margin-top:10px;"></div>
                <div class="warn">Upload a template first, then fill out the form and click generate!</div>
            </div>
        </div>

        <script>
            const parishData = {
                "Acadia": { district: "15TH", da: "Donald D. Landry" },
                "Allen": { district: "33RD", da: "Joe Green" },
                "Ascension": { district: "23RD", da: "Ricky Babin" },
                "Assumption": { district: "23RD", da: "Ricky Babin" },
                "Avoyelles": { district: "12TH", da: "Charles A. Riddle, III" },
                "Beauregard": { district: "36TH", da: "James R. Lestage" },
                "Bienville": { district: "2ND", da: "Danny Newell" },
                "Bossier": { district: "26TH", da: "John \"Schuyler\" Marvin" },
                "Caddo": { district: "1ST", da: "James E. Stewart, Sr." },
                "Calcasieu": { district: "14TH", da: "Stephen Dwight" },
                "Caldwell": { district: "37TH", da: "Brian Frazier" },
                "Cameron": { district: "38TH", da: "W. Thomas Barrett, III" },
                "Catahoula": { district: "7TH", da: "Bradley R. Burget" },
                "Claiborne": { district: "2ND", da: "Danny Newell" },
                "Concordia": { district: "7TH", da: "Bradley R. Burget" },
                "DeSoto": { district: "42ND", da: "Charles B. Adams" },
                "East Baton Rouge": { district: "19TH", da: "Hillar C. Moore, III" },
                "East Carroll": { district: "6TH", da: "James E. Paxton" },
                "East Feliciana": { district: "20TH", da: "Samuel C. D'Aquilla" },
                "Evangeline": { district: "13TH", da: "Trent Brignac" },
                "Franklin": { district: "5TH", da: "Penny Douciere" },
                "Grant": { district: "35TH", da: "James \"Jay\" P. Lemoine" },
                "Iberia": { district: "16TH", da: "M. Michael Haik, III" },
                "Iberville": { district: "18TH", da: "Antonio M. Clayton" },
                "Jackson": { district: "2ND", da: "Danny Newell" },
                "Jefferson": { district: "24TH", da: "Paul D. Connick, Jr." },
                "Jefferson Davis": { district: "31ST", da: "Lauren Heinen" },
                "Lafayette": { district: "15TH", da: "Donald D. Landry" },
                "Lafourche": { district: "17TH", da: "Kristine M. Russell" },
                "LaSalle": { district: "28TH", da: "J. Reed Walters" },
                "Lincoln": { district: "3RD", da: "John F. Belton" },
                "Livingston": { district: "21ST", da: "Scott M. Perrilloux" },
                "Madison": { district: "6TH", da: "James E. Paxton" },
                "Morehouse": { district: "4TH", da: "Robert S. Tew" },
                "Natchitoches": { district: "10TH", da: "Billy Joe Harrington" },
                "Orleans": { district: "41ST", da: "Jason R. Williams" },
                "Ouachita": { district: "4TH", da: "Robert S. Tew" },
                "Plaquemines": { district: "25TH", da: "Charles J. Ballay" },
                "Pointe Coupee": { district: "18TH", da: "Antonio M. Clayton" },
                "Rapides": { district: "9TH", da: "Phillip Terrell, Jr." },
                "Red River": { district: "39TH", da: "Julie C. Jones" },
                "Richland": { district: "5TH", da: "Penny Douciere" },
                "Sabine": { district: "11TH", da: "Don M. Burkett" },
                "St. Bernard": { district: "34TH", da: "Perry M. Nicosia" },
                "St. Charles": { district: "29TH", da: "Joel T. Chaisson II" },
                "St. Helena": { district: "21ST", da: "Scott M. Perrilloux" },
                "St. James": { district: "23RD", da: "Ricky Babin" },
                "St. John the Baptist": { district: "40TH", da: "Bridget A. Dinvaut" },
                "St. Landry": { district: "27TH", da: "Chad P. Pitre" },
                "St. Martin": { district: "16TH", da: "M. Michael Haik, III" },
                "St. Mary": { district: "16TH", da: "M. Michael Haik, III" },
                "St. Tammany": { district: "22ND", da: "J. Collin Sims" },
                "Tangipahoa": { district: "21ST", da: "Scott M. Perrilloux" },
                "Tensas": { district: "6TH", da: "James E. Paxton" },
                "Terrebonne": { district: "32ND", da: "Joseph L. Waitz, Jr." },
                "Union": { district: "3RD", da: "John F. Belton" },
                "Vermilion": { district: "15TH", da: "Donald D. Landry" },
                "Vernon": { district: "30TH", da: "Terry Lambright" },
                "Washington": { district: "22ND", da: "J. Collin Sims" },
                "Webster": { district: "26TH", da: "John \"Schuyler\" Marvin" },
                "West Baton Rouge": { district: "18TH", da: "Antonio M. Clayton" },
                "West Carroll": { district: "5TH", da: "Penny Douciere" },
                "West Feliciana": { district: "20TH", da: "Samuel C. D'Aquilla" },
                "Winn": { district: "8TH", da: "R. Chris Nevils" }
            }

            // Helpers
            const $ = (id) => document.getElementById(id);

            function getRadio(name) {
                const el = document.querySelector(`input[name="${name}"]:checked`);
                return el ? el.value : "";
            }

            function populateParishes() {
                const parishSelect = $("parish");
                const parishes = Object.keys(parishData).sort((a,b) => a.localeCompare(b));
                for (const p of parishes) {
                    const opt = document.createElement("option");
                    opt.value = p;
                    opt.textContent = p;
                    parishSelect.appendChild(opt);
                }
            }

            function updateDaAndDistrict() {
                const p = $("parish").value;
                const hint = $("districtHint");

                if (p && parishData[p]) {
                    const dist = parishData[p].district || "";
                    hint.textContent = `✓ ${dist} Judicial District Court`;
                    hint.style.display = dist ? "block" : "none";
                } else {
                    hint.style.display = "none";
                }
            }

            function generateDocx(templateArrayBuffer, data) {
                try {
                    const PizZipLib = window.PizZip;
                    if (!PizZipLib) throw new Error("PizZip library not loaded. Check script tags and order")
                    
                    const zip = new PizZipLib(templateArrayBuffer);

                    const Docxtemplater = 
                    window.docxtemplater?.Docxtemplater ||
                    window.docxtemplater ||
                    window.Docxtemplater;
                    if (!Docxtemplater) {
                        throw new Error("Docxtemplater library not found.");
                    }

                    const doc = new Docxtemplater(zip, {
                        paragraphLoop: true,
                        linebreaks: true,
                    });

                    try {
                        doc.render(data);
                    } catch (e) {
                        console.error("DOCX RENDER FAILED: ", e);

                        if (e.properties?.errors?.length) {
                            e.properties.errors.forEach((err, i) => {
                            console.error(`Render error #${i + 1}:`, err.properties?.explanation || err);
                            });
                        }
                        throw e;
                    }

                    console.log("Rendered preview:", doc.getFullText().slice(0, 200));

                    return doc.getZip().generate({
                        type: "blob",
                        mimeType: "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                    });

                } catch (e) {
                    console.error("DOCXTEMPLATER RENDER ERROR:", e);

                    if (e.properties && Array.isArray(e.properties.errors)) {
                        e.properties.errors.forEach((err, i) => {
                            console.error(`Error ${i + 1}:`, err);
                            if (err.properties && err.properties.explanation) {
                                console.error("Explanation:", err.properties.explanation);
                            }
                        });
                    }
                    throw e;
                }
            }    

            function formatServiceDate(date) {
                const day = "____";
                const month = date.toLocaleString('en-US', { month: 'long' });
                const year = date.getFullYear();
    
                return `${day} day of ${month}, ${year}`;
            }    
                
            document.addEventListener("DOMContentLoaded", () => {
                // Initialize parishes
                populateParishes();
                updateDaAndDistrict();

                // Auto-set to today
                const today = new Date();
                $("serviceDatePicker").value = today.toISOString().split("T")[0];
                $("serviceDateDisplay").textContent = formatServiceDate(today);

                $("serviceDatePicker").addEventListener("change", (e) => {
                    const selectedDate = new Date(e.target.value + "T00:00:00");
                    $("serviceDateDisplay").textContent = formatServiceDate(selectedDate);
                });

                $("parish").addEventListener("change", updateDaAndDistrict);

                //JSON Objection loader
                let objectionLibrary = [];

                fetch("./objections.json")
                    .then(res => res.json())
                    .then(data => {
                        objectionLibrary = data;

                        const sel = $("bureauObjectionPreset");
                        data.forEach(item => {
                            const opt = document.createElement("option");
                            opt.value = item.id;
                            opt.textContent = item.label;
                            sel.appendChild(opt);
                        });
                    })
                    .catch(err => {
                        console.error("Could not load objections.json", err);
                    });

                const box = $("bureauObjectionText");
                const preset = $("bureauObjectionPreset");

                $("addBureauObjectionBtn").addEventListener("click", () => {
                    const chosenId = preset.value;
                    if (!chosenId) return;

                    const found = objectionLibrary.find(o => o.id === chosenId);
                    if (!found || !found.text) return;

                    const chunk = found.text.trim();

                    //Append with spacing
                    box.value = box.value.trim()
                        ? box.value.trim() + "\n\n" + chunk
                        : chunk;

                        // Auto-switch to opposition
                        document.querySelector(
                            'input[name="bureauResponse"][value="opposition"]'
                        ).checked = true;
                });

                $("clearBureauObjectionBtn").addEventListener("click", () => {
                    box.value = "";
                    chosenId.value = "";
                });

                preset.addEventListener("change", () => {
                    const chosenId = preset.value;
                    if (!chosenId) return;

                    const found = objectionLibrary.find(o => o.id === chosenId);
                    if (!found) return;

                    document.querySelector(
                        'input[name="bureauResponse"][value="opposition"]'
                    ).checked = true
                })

                //Template upload handler
                let templateContent = null;
            
                $("templateFile").addEventListener("change", (e) => {
                    const file = e.target.files && e.target.files[0];
                    const status = $("templateStatus");
                    if (!file) {
                        status.textContent = "No file selected.";
                        status.style.color = "#b45309";
                        templateContent = null;
                        $("generateBtn").disabled = true;
                        return;
                    }
                    //Extension checker
                    if (!file.name.toLowerCase().endsWith(".docx")) {
                        status.textContent = "Please upload a valid .docx file.";
                        status.style.color = "#b45309";
                        templateContent = null;
                        $("generateBtn").disabled = true;
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (evt) => {
                        templateContent = evt.target.result; //ArrayBuffer
                        status.textContent = `✓ Loaded template: ${file.name}`;
                        status.style.color = "#065f46";
                        $("generateBtn").disabled = false;
                    };
                    reader.onerror = () => {
                        status.textContent = "✗ Error reading file.";
                        status.style.color = "#b45309";
                        templateContent = null;
                        $("generateBtn").disabled = true;
                    };
                    reader.readAsArrayBuffer(file);
                });

                $("generateBtn").addEventListener("click", async () => {
                    const status = $("status");
                    if (!templateContent) {
                        status.textContent = "Please upload a .docx template first.";
                        status.style.color = "#b45309";
                        return;
                    }

                    const respondingParty = "bureau";

                    const data = {
                        fileNumber: $("fileNumber").value.trim(),
                        logNumber: $("logNumber").value.trim(),
                        defendantName: $("defendantName").value.trim(),
                        docketNumber: $("docketNumber").value.trim(),
                        division: $("division").value.trim(),
                        parish: $("parish").value,
                        parishUpper: $("parish").value ? $("parish").value.toUpperCase() : "",
                        district: $("parish").value && parishData[$("parish").value] ? parishData[$("parish").value].district : "",
                             
                        bureauResponse: getRadio("bureauResponse"),
                        bureauNoOpposition: getRadio("bureauResponse") === "no-opposition",
                        bureauOpposition: getRadio("bureauResponse") === "opposition",
                        bureauNoOppositionText: $("bureauNoOppositionText").value.trim(),
                        bureauObjectionText: $("bureauObjectionText").value.trim(),
  
                        arrestingAgency: $("arrestingAgency").value.trim(),
                        defenseAttorney: $("defenseAttorney").value.trim(),
                        defenseAddress: $("defenseAddress").value.trim(),
                        serviceDate: $("serviceDateDisplay").textContent,

                        respondingParty: respondingParty,
                    };

                    const defenseRecipient = $("defenseRecipient").value; //"counsel" or "defendant"

                    data.defenseRecipient = defenseRecipient;
                    data.defenseServiceLabel = defenseRecipient === "defendant" ? "Defendant" : "Defendant, through counsel of record";


                    //This is the printable line in the certificate/service section
                    const defenseName = ($("defenseAttorney")?.value || "").trim();
                    const defenseAddr = ($("defenseAddress").value || "").trim();

                    if (defenseRecipient === "defendant") {
                        //If pro se, it reads cleaner as "Defendant: [Name], [Address]"
                        data.defenseServiceText = defenseAddr ? `${defenseName}, ${defenseAddr}` : {defenseName};
                    } else {
                        //Counsel, same format already used
                        data.defenseServiceText = defenseAddr ? `${defenseName}, ${defenseAddr}` : {defenseName};
                    }

                //Control which sections show
                data.showDA = true;
                data.showBureau = true;
                data.showAgency = true;

                //We only speak for the Bureau, so DA & Agency are unchecked
                data.daName = parishData[data.parish]?.da || "";
                data.daNoOpposition = false;
                data.daOpposition = false;
                data.daObjectionText = "";

                data.agencyName = "";
                data.agencyNoOpposition = false;
                data.agencyOpposition = false;
                data.agencyNoOppositionText = "";
                data.agencyObjectionText = "";
            
                data.defendantNameUpper = data.defendantName ? data.defendantName.toUpperCase() : "";

                // Validate required fields
                const missing = [];
                if (!data.defendantName) missing.push("Defendant Name");
                if (!data.parish) missing.push("Parish");
                if (!data.docketNumber) missing.push("Docket Number");

                if (missing.length) {
                    status.textContent = "Missing required: " + missing.join(", ");
                    status.style.color = "#b45309";
                    return;
                }

                // Determine if showing no opposition box
                const bureauResponse = getRadio("bureauResponse");

                data.bureauNoOpposition = bureauResponse === "no-opposition";
                data.bureauOpposition = bureauResponse === "opposition";

                data.showNoOppositionBox = data.bureauNoOpposition;

                data.noOppositionText = data.bureauNoOppositionText?.trim() || "The Bureau does not oppose this motion for expungement.";

                //Determine opposition status for filename
                let responseStatus = data.bureauOpposition ? "Opposition" : "NoOpposition";

                console.log("DOCX DATA CHECK", {
                    bureauNoOpposition: data.bureauNoOpposition,
                    showNoOppositionBox: data.showNoOppositionBox,
                    noOppositionText: data.noOppositionText
                })

                try {
                    const blob = await generateDocx(templateContent, data);
                
                    const safeFile = (data.fileNumber || "NoFile").replace(/\s+/g, "_").replace(/[^\w\-]/g, "");
                    const safeLog = (data.logNumber || "NoLog").replace(/\s+/g, "_").replace(/[^\w\-]/g, "");
                    const safeName = data.defendantName.replace(/\s+/g, "_").replace(/[^\w\-]/g, "");
                    const safeDocket = data.docketNumber.replace(/\s+/g, "_").replace(/[^\w\-]/g, "");
                    const safeParish = data.parish.replace(/\s+/g, "_").replace(/[^\w\-]/g, "");
                    
                    const filename = `Affidavit of Response - ${safeFile} ${safeLog} ${safeName} ${safeDocket} ${safeParish} ${responseStatus}.docx`;

                    saveAs(blob, filename);
                    status.textContent = "Generated and downloaded: " + filename;
                    status.style.color = "#065f46";

                    resetForm();
                } catch (err) {
                    status.textContent = "Error generating document.";
                    status.style.color = "#b45309";
                    console.error("Error:", err);
                }
            });
        });

        function resetForm() {
            //Clear text inputs + txtareas (but NOT file input)
            document.querySelectorAll('input[type="text"], textarea'). forEach(el => {
                el.value = "";
            });

            //Reset parish dropdown
            $("parish").value = "";
            $("districtHint").style.display = "none";

            //Reset Bureau radios to "No Opposition"
            const noOpp = document.querySelector('input[name="bureauResponse"][value="no-opposition"]');
            if (noOpp) noOpp.checked = true;

            //Reset Bureau default text
            $("bureauNoOppositionText").value = "The Bureau does not oppose this motion for expungement.";
            $("bureauObjectionText").value = "";

            //Reset defense recipient selector
            const dr = $("defenseRecipient");
            if (dr) dr.value = "counsel";

            //Reset service date to today
            const today = new Date();
            $("serviceDatePicker").value = today.toISOString().split("T")[0];
            $("serviceDateDisplay").textContent = formatServiceDate(today);
        }
        </script>
    </body>
</html>
